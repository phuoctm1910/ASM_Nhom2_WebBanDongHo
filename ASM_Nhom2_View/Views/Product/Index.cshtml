@using Microsoft.AspNetCore.Http
@using System.Collections.Generic
@model List<ASM_Nhom2_View.Data.Product>
@{

    Layout = null;
    string FullName = Context.Session.GetString("FullName");
    string Email = Context.Session.GetString("Email");
    bool isLoggedIn = !string.IsNullOrEmpty(Email);
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sản Phẩm</title>
    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--Icon-->
    <script src="https://kit.fontawesome.com/b4d3d14cb1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/product.css" asp-append-version="true" />

</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg bg-white border" style="padding: 0!important;">
            <div class="row container-fluid p-0">
                <a class="navbar-brand col-2 text-center " asp-area="" asp-controller="Home" asp-action="Index">
                    <img src="~/images/logo.png" alt="logo" width="100px">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse col-7" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link nav-home" asp-area="" asp-controller="Home" asp-action="About">Giới thiệu</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-home" asp-area="" asp-controller="Home" asp-action="Contact">Liên hệ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-home" asp-area="" asp-controller="Product" asp-action="Index">Sản phẩm</a>
                        </li>
                    </ul>
                    <form class="d-flex" role="search" style="width: 400px;">
                        <div class="input-group">
                            <input type="search" class="form-control" placeholder="Tìm kiếm"
                                   aria-describedby="button-addon2">
                            <button class="btn btn-outline-dark" type="submit" id="button-addon2">Search</button>
                        </div>
                    </form>
                </div>
                <div class="col-3 position-relative text-dark">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 position-absolute text-black" style="left: 90px;top: -20px;">
                        <li class="nav-item dropdown d-flex nav-home">
                            @if (isLoggedIn)
                            {
                                <a class="nav-link dropdown-toggle text-start" role="button" data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    Hello, @FullName
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="HistoryBill">Lịch sử thanh toán</a></li>
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="Changeinfo">Đổi thông tin</a></li>
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="Changepassword">Đổi mật khẩu</a></li>
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="Logout">Đăng xuất</a></li>
                                </ul>
                            }
                            else
                            {
                                <a class="nav-link dropdown-toggle text-start" role="button" data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    Tài khoản
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="Register">Đăng ký</a></li>
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="Login">Đăng nhập</a></li>
                                    <li><a class="dropdown-item" asp-controller="User" asp-action="ForgotPassword">Quên mật khẩu</a></li>
                                </ul>
                            }


                            <hr />
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-end position-relative nav-home" role="button" asp-controller="Cart" asp-action="Index">
                                Giỏ hàng
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div>
        <main class="my-4">
            <div class="container">
                <!--Slide ảnh-->
                <div class="row">
                    <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                                    aria-current="true" aria-label="Slide 1"></button>
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1"
                                    aria-label="Slide 2"></button>
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2"
                                    aria-label="Slide 3"></button>
                        </div>
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="https://donghotantan.vn/images/products/manufactories//large/bulova-banner_1712631472.jpg"
                                     alt="Los Angeles" class="d-block" style="width:70%;height: 350px;margin: 0 auto;">
                            </div>
                            <div class="carousel-item">
                                <img src="https://donghotantan.vn/images/products/manufactories//large/banner-lacoste_1710995099.jpg"
                                     alt="Chicago" class="d-block" style="width:70%;height: 350px;margin: 0 auto;">
                            </div>
                            <div class="carousel-item">
                                <img src="https://h2watch.vn/wp-content/uploads/2020/03/dong-ho-tissot-banner.jpg"
                                     alt="New York" class="d-block" style="width:70%;height: 350px;margin: 0 auto;">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark"
                                data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark"
                                data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
                <!--Button lọc loại sản phẩm-->
                <div class="row sortList my-5">
                    <div class="text-center">
                        <h2 class="mt-5 mb-3" style="color: #383736; font-weight: 500">
                            THƯƠNG HIỆU
                        </h2>
                    </div>
                    <div class="d-flex flex-wrap justify-content-center mt-2 mb-5">
                        <a class="btnSort" style="text-decoration: none">CASIO</a>
                        <a class="btnSort" style="text-decoration: none">CITIZEN</a>
                        <a class="btnSort" style="text-decoration: none">OMEGA</a>
                        <a class="btnSort" style="text-decoration: none">GUCCI</a>
                        <a class="btnSort" style="text-decoration: none">SEIKO</a>
                        <a class="btnSort" style="text-decoration: none">COACH</a>
                        <a class="btnSort" style="text-decoration: none">ALFEX</a>
                        <a class="btnSort" style="text-decoration: none">TOMMY</a>
                    </div>
                </div>
                <!--Tải hướng dẫn sử dụng và sắp xếp theo chỉ định khác-->
                <div class="row">
                    <div class="d-flex justify-content-between">
                        <div class="productCount">
                            <span>
                                Tổng Sản Phẩm : <span id="totalProductCount">@Model.Count</span>
                            </span>
                        </div>
                        <div class="productfilter d-flex align-items-center">
                            <div class="productCount">
                                <span>
                                    Download Catalogue <i class="fa-solid fa-download"></i> :
                                </span>
                            </div>
                            <div>
                                <a class="btn btnCata" href="https://drive.google.com/drive/folders/1yPZCbQAqy4hWBl-5wZhab78xNyDQFSLt?usp=sharing">Catalogue <i class="fa-solid fa-file"></i></a>
                            </div>
                            <span class="columnsSpace"></span>
                            <div class="fitlerSelect">
                                <select class="filter-order fs-14">
                                    <option value="0">Xếp theo: Mặc định</option>
                                    <option value="1">Giá Thấp đến cao</option>
                                    <option value="2">Giá Cao đến thấp</option>
                                    <option value="3">Đang giảm giá</option>
                                    <option value="4">Nổi bật</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Sản phẩm-->
                <div class="row my-3" id="productContainer">
                    @foreach (var item in Model)
                    {
                        <div class="col-md-3 my-3 product">
                            <div>
                                <div class="card">
                                    <div class="imgBox">
                                        <a class="card-link" asp-controller="ProductDetail" asp-action="Index" asp-route-id="@item.ProductId">
                                            @if (item.ProductImageList.Any())
                                            {
                                                <img src="@Url.Content("~/uploads/" + item.ProductImageList.First())" width="280px;" height="300px;" alt="@item.ProductName" class="watch">
                                            }
                                            else
                                            {
                                                <img src="@Url.Content("~/uploads/default.png")" alt="default image" class="watch">
                                            }
                                        </a>
                                    </div>
                                    <div class="contentBox">
                                        <h3>@item.ProductName</h3>
                                        <h2 class="price">@item.ProductPrice.ToString("#,##0").Replace(",", ".") ₫</h2>
                                        <button class="buy bg-btn addProduct" data-product-id="@item.ProductId">Thêm vào giỏ hàng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                @if (Model.Count > 8)
                {
                    <div class="row" style="margin: 20px auto;width: fit-content;">
                        <button class="btnMore fill" id="btnShowMore">Xem Thêm <i class="fa-solid fa-plus"></i></button>
                        <button class="btnMore fill" id="btnShowLess" style="display:none;">Ẩn Bớt <i class="fa-solid fa-minus"></i></button>
                    </div>
                }
            </div>
        </main>
    </div>
    <footer>
        <div class="text-white" style="background-color: #393939;">
            <div class="container lh-1 p-4">
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <p class="fw-bold">NHỮNG THƯƠNG HIỆU</p>
                        <p>CASIO</p>
                        <p>LACOSTE</p>
                        <p>BULOVA</p>
                        <p>CALVIN KLEIN</p>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <p class="fw-bold">CÁC PHONG CÁCH ĐỒNG HỒ</p>
                        <p>THỂ THAO</p>
                        <p>SANG TRỌNG</p>
                        <p>CỔ ĐIỂN</p>
                        <p>THANH LỊCH</p>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <p class="fw-bold">THÔNG TIN CHUNG</p>
                        <p>CHÍNH SÁCH BẢO MẬT</p>
                        <p>ĐIỀU KHOẢN SỬ DỤNG</p>
                        <p>TƯ VẤN</p>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <p class="fw-bold">THEO DÕI</p>
                        <div class="d-flex" style="word-spacing: 10px;">
                            <a><img src="https://i.ibb.co/fXnhkLZ/icons8-zalo-32.png"></a>
                            <a class="mx-3"><img src="https://i.ibb.co/KGQpqKr/icons8-facebook-32.png"></a>
                            <a><img src="https://i.ibb.co/h8M2n9W/icons8-youtube-32.png"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-white" style="font-size: 12px; background-color: #242323;">
            <div class="container lh-1 p-4">
                <span class="fs-6">
                    Copyright © 2024 WatchFives Group. All right reserved. Designed by Sudo |
                    nicedesign.works
                </span>
            </div>
        </div>

    </footer>
    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" integrity="sha512-TPh2Oxlg1zp+kz3nFA0C5vVC6leG/6mm1z9+mA81MI5eaUVqasPLO8Cuk4gMF4gUfP5etR73rgU/8PNMsSesoQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var itemsPerPage = 8; // Số lượng sản phẩm hiển thị mỗi lần
            var totalItems = $('.product').length; // Tổng số sản phẩm
            var visibleCount = itemsPerPage; // Bắt đầu hiển thị số lượng ban đầu

            // Ẩn các sản phẩm vượt quá số lượng ban đầu
            $('.product').slice(visibleCount).hide();

            // Kiểm tra số lượng sản phẩm ban đầu để ẩn nút "Ẩn Bớt"
            if (totalItems <= itemsPerPage) {
                $('#btnShowLess').hide(); // Ẩn nút "Ẩn Bớt" khi số lượng sản phẩm ít hơn hoặc bằng itemsPerPage
            }

            // Hàm hiển thị thêm sản phẩm
            function showMore() {
                var hiddenItems = $('.product:hidden');
                var numToShow = Math.min(hiddenItems.length, itemsPerPage);
                hiddenItems.slice(0, numToShow).slideDown();
                visibleCount += numToShow;

                // Hiển thị nút "Ẩn Bớt" khi đã hiển thị hết số lượng sản phẩm ban đầu
                if (visibleCount > itemsPerPage) {
                    $('#btnShowLess').show(); // Hiển thị nút "Ẩn Bớt"
                }

                // Ẩn nút "Xem Thêm" nếu đã hiển thị hết sản phẩm
                if (visibleCount >= totalItems) {
                    $('#btnShowMore').hide(); // Ẩn nút "Xem Thêm"
                }
            }

            // Hàm ẩn bớt sản phẩm
            function showLess() {
                // Tính số lượng sản phẩm cần ẩn
                var numToHide = Math.min(visibleCount - itemsPerPage, itemsPerPage);

                if (visibleCount > itemsPerPage) {
                    $('.product:visible').slice(-numToHide).slideUp();
                    visibleCount -= numToHide;
                }

                // Ẩn nút "Ẩn Bớt" khi không còn sản phẩm để ẩn
                if (visibleCount <= itemsPerPage) {
                    $('#btnShowLess').hide(); // Ẩn nút "Ẩn Bớt"
                }

                // Hiển thị lại nút "Xem Thêm"
                $('#btnShowMore').show(); // Hiển thị nút "Xem Thêm"
            }

            // Sự kiện click vào nút "Xem Thêm"
            $('#btnShowMore').click(function () {
                showMore();
            });

            // Sự kiện click vào nút "Ẩn Bớt"
            $('#btnShowLess').click(function () {
                showLess();
            });



            $('.addProduct').click(function () {
                var productId = $(this).data('product-id');
                addProductToBill(productId);
            })

            function addProductToBill(productId) {
                $.ajax({
                    url: '@Url.Action("CreateBill", "Bill")',
                    type: 'POST',
                    data: { productId: productId },
                    success: function (response) {
                        if (response.success) {
                            alert(response.message);
                        } else {
                            console.log(response.message);
                        }
                    },
                    error: function (respone) {
                        alert('Xảy ra lỗi khi cố gắng thêm sản phẩm vào bill.');
                        console.log(respone.message);
                    }
                });
            }
        });

    </script>
    <script>

    </script>
</body>
</html>

